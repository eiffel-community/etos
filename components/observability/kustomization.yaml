apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component
resources:
  - ./resources/otel-collector.yaml
  # TODO: Generate
  - ./resources/otel-configmap.yaml


patches:
- target:
    kind: Deployment
    name: (etos-api|etos-suite-starter)
  patch: |-
    - op: add
      path: /spec/template/metadata/annotations
      value: {}
    - op: add
      path: /spec/template/metadata/annotations/sidecar.opentelemetry.io~1inject
      value: "true"
- target:
    kind: Deployment
    name: (etos-api|etos-suite-starter)
  patch: |-
    - op: add
      path: /spec/template/spec/containers/0/envFrom/-
      value:
        configMapRef:
          name: etos-observability
